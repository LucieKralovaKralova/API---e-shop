<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PRODUCTS for e-shop</title>
</head>
<body>
<style>
    .failure{
        color: red;
        font-size: 20px;
    }

    .success{
        color: green;
        font-size: 20px;
    }

    .validation-error{
        border: 2px;
        border-style: solid;
        border-color: rgb(220, 10, 10);
    }
</style>
<script>


    function loadProducts() {

        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };

        let loadForSale = document.querySelector("#loadForSale-checkbox");
        if (loadForSale.checked === false) {

            fetch("http://localhost:8080/products", requestOptions)
                .then(response => response.json())
                .then(result => {
                    console.log(result);

                    document.querySelector("#workField").innerHTML = '';

                    result.forEach((item) => {

                        const lineDiv = document.createElement('div');
                        lineDiv.id = "line-div" + item.id;

                        const idTextarea = document.createElement('textarea');
                        idTextarea.setAttribute("disabled", "true");
                        idTextarea.value = item.id;

                        const partNoTextarea = document.createElement('textarea');
                        partNoTextarea.value = item.partNo;

                        const nameTextarea = document.createElement('textarea');
                        nameTextarea.value = item.name;

                        const descriptionTextarea = document.createElement('textarea');
                        descriptionTextarea.value = item.description;

                        const priceTextarea = document.createElement('textarea');
                        priceTextarea.value = item.price;

                        const forSaleCheckBox = document.createElement("input");
                        forSaleCheckBox.setAttribute("type", "checkbox");
                        forSaleCheckBox.checked = item.isForSale;

                        lineDiv.appendChild(idTextarea);
                        lineDiv.appendChild(partNoTextarea);
                        lineDiv.appendChild(nameTextarea);
                        lineDiv.appendChild(descriptionTextarea);
                        lineDiv.appendChild(priceTextarea);
                        lineDiv.appendChild(forSaleCheckBox);

                        document.getElementById("workField").appendChild(lineDiv);
                    })
                })
                .catch(error => console.log('error', error));
        } else {
            loadOnlyForSaleProducts();
        }

    }

    function loadOnlyForSaleProducts() {

        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };

        fetch("http://localhost:8080/productsForSale", requestOptions)
            .then(response => response.json())
            .then(result => {
                console.log(result);

                document.querySelector("#workField").innerHTML = '';

                result.forEach((item) => {

                    const lineDiv = document.createElement('div');
                    lineDiv.id = "line-div"+item.id;

                    const idTextarea = document.createElement('textarea');
                    idTextarea.setAttribute("disabled", "true");
                    idTextarea.value = item.id;

                    const partNoTextarea = document.createElement('textarea');
                    partNoTextarea.value = item.partNo;

                    const nameTextarea = document.createElement('textarea');
                    nameTextarea.value = item.name;

                    const descriptionTextarea = document.createElement('textarea');
                    descriptionTextarea.value = item.description;

                    const priceTextarea = document.createElement('textarea');
                    priceTextarea.value = item.price;

                    const forSaleCheckBox = document.createElement("input");
                    forSaleCheckBox.setAttribute("type", "checkbox");
                    forSaleCheckBox.checked = item.isForSale;

                    lineDiv.appendChild(idTextarea);
                    lineDiv.appendChild(partNoTextarea);
                    lineDiv.appendChild(nameTextarea);
                    lineDiv.appendChild(descriptionTextarea);
                    lineDiv.appendChild(priceTextarea);
                    lineDiv.appendChild(forSaleCheckBox);

                    document.getElementById("workField").appendChild(lineDiv);

                })
            })
            .catch(error => console.log('error', error));

    }


    function loadById() {

        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };

        var id = document.getElementById("id").value;

        fetch("http://localhost:8080/product/"+ id, requestOptions)
            .then(response => response.json())
            .then(result => {
                console.log(result);


                    document.getElementById("productId").value = result.id;
                    document.getElementById("productPartNo").value = result.partNo;
                    document.getElementById("productName").value = result.name;
                    document.getElementById("productDescription").value = result.description;
                    document.getElementById("productPrice").value = result.price;
                    document.getElementById("productForSale").checked = result.isForSale;



            })
            .catch(error => console.log('error', error));

    }


    function loadByPartNo() {

        var requestOptions = {
            method: 'GET',
            redirect: 'follow'
        };

        var partNo = document.getElementById("partNo").value;

        fetch("http://localhost:8080/productPart/"+ partNo, requestOptions)
            .then(response => response.json())
            .then(result => {
                console.log(result);


                document.getElementById("productId").value = result.id;
                document.getElementById("productPartNo").value = result.partNo;
                document.getElementById("productName").value = result.name;
                document.getElementById("productDescription").value = result.description;
                document.getElementById("productPrice").value = result.price;
                document.getElementById("productForSale").checked = result.isForSale;



            })
            .catch(error => console.log('error', error));

    }

    function addProduct(){
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        var raw = JSON.stringify({
            "partNo": document.getElementById("productPartNo").value,
            "name": document.getElementById("productName").value,
            "description": document.getElementById("productDescription").value,
            "price": document.getElementById("productPrice").value,
            "isForSale": document.getElementById("productForSale").checked
        });

        var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };

        document.getElementById('productPartNo').classList.remove('validation-error');
        document.getElementById('productName').classList.remove('validation-error');
        document.getElementById('productPrice').classList.remove('validation-error');

        if (document.getElementById("productPartNo").value === ''){
            console.log('Validation error');
            document.getElementById('messageBox').classList.add('failure');
            document.getElementById('messageBox').innerText = "Vyplňte prosím číslo produktu PN";
            document.getElementById('productPartNo').classList.add('validation-error');

            return;
        }
        if (document.getElementById("productName").value === ''){
            console.log('Validation error');
            document.getElementById('messageBox').classList.add('failure');
            document.getElementById('messageBox').innerText = "Vyplňte prosím název produktu";
            document.getElementById('productName').classList.add('validation-error');

            return;
        }
        if (document.getElementById("productPrice").value === ''){
            console.log('Validation error');
            document.getElementById('messageBox').classList.add('failure');
            document.getElementById('messageBox').innerText = "Vyplňte prosím cenu produktu";
            document.getElementById('productPrice').classList.add('validation-error');

            return;
        }
        var S = document.getElementById("productPartNo").value;
        if ((parseInt(S) === NaN) || (parseInt(S)+'' != S)){
            console.log('Validation error');
            document.getElementById('messageBox').classList.add('failure');
            document.getElementById('messageBox').innerText = "Špatně zadané číslo";
            document.getElementById('productPartNo').classList.add('validation-error');

            return;
        }

        document.getElementById('messageBox').innerText = "UKLÁDÁNÍ";
        document.getElementById('messageBox').classList.remove('failure');
        document.getElementById('messageBox').classList.remove('success');


        fetch("http://localhost:8080/product", requestOptions)
            .then(response => response.text())
            .then(result => {
                console.log(result);
                document.getElementById('messageBox').innerText = "ÚSPĚŠNĚ PŘIDÁNO";
                document.getElementById('messageBox').classList.add('success');
            })
            .catch(error => console.log('error', error));
                document.getElementById('messageBox').innerText = "CHYBA";
                document.getElementById('messageBox').classList.add('failure');

    }


    function deleteNotForSale() {
        var requestOptions = {
            method: 'DELETE',
            redirect: 'follow'
        };

            console.log("Bylo kliknuto na Vymazat všechny produkty, co nejsou k prodeji")

            if (confirm("Opravdu chcete nenávratně odstranit všechny produkty, které nejsou na prodej?")== true) {
                fetch("http://localhost:8080/product", requestOptions)
                    .then(response => response.text())
                    .then(result => {console.log(result);})
                    .catch(error => console.log('error', error));
                alert("Položky byly vymazány")
            } else {
                console.log ("Položky nebyly vymazány")
            }

    }



</script>


<h1>PRODUKTOVÝ LIST</h1>
<p>Jednoduchá základní API pro správu e-shopu</p>

<div>
    <button id="load-all-button" onclick="loadProducts()">VYPSAT PRODUKTY</button>
    <input id="loadForSale-checkbox" type="checkbox">
    <label for="loadForSale-checkbox">Vypsat pouze produkty na prodej</label>
    <br>
    <br>
    <br>
    <br>
    <button id="load-by-id-button" onclick="loadById()">NAJÍT PRODUKT PODLE ID: </button>
    <textarea id="id" cols="10" rows="1"></textarea>
    <br>
    <button id="load-by-partNo-button" onclick="loadByPartNo()">NAJÍT PRODUKT PODLE ČÍSLA PRODUKTU PN:  </button>
    <textarea id="partNo" cols="10" rows="1"></textarea>
    <br>

</div>
<br>
<br>
<div id="messageBox"></div>
<div>
    <input id="titleId" type="text" placeholder="ID" style="text-align: center; font-weight: 900; width: 162px; background-color: #c3e5f6">
    <input id="titlePartNo" type="text" placeholder="PN" style="text-align: center; font-weight: 900; width: 162px; background-color: #c3e5f6">
    <input id="titleName" type="text" placeholder="NÁZEV" style="text-align: center; font-weight: 900; width: 162px; background-color: #c3e5f6">
    <input id="titleDescription" type="text" placeholder="POPIS" style="text-align: center; font-weight: 900; width: 162px; background-color: #c3e5f6">
    <input id="titlePrice" type="text" placeholder="CENA" style="text-align: center; font-weight: 900; width: 162px; background-color: #c3e5f6">
    <input id="titleForSale" type="text" placeholder="SKLADEM" style="text-align: center; font-weight: 900; width: 80px; background-color: #c3e5f6">
    <br>
</div>
<div>
    <textarea id="productId" disabled></textarea>
    <textarea id="productPartNo"></textarea>
    <textarea id="productName"></textarea>
    <textarea id="productDescription"></textarea>
    <textarea id="productPrice"></textarea>
    <input id="productForSale" type="checkbox">
    <button id="add-button" style="margin-left: 80px" onclick="addProduct()">PŘIDAT PRODUKT</button>
</div>
<div id="workField">
</div>
<br>
<br>
<br>
<button id="delete-not-for-sale-button" onclick="deleteNotForSale()">VYMAZAT VŠECHNY PRODUKTY, KTERÉ JIŽ NEJSOU K PRODEJI  </button>
</body>
</html>